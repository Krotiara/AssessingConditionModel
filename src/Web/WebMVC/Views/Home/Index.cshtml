@{
    ViewData["Title"] = "Home Page";
}

<html>
<head>
    <title>Главная страница</title>
    <style>
            th {text-align: center; font-weight: normal;}
    </style>
</head>
<body>
    
    <table style="width:50%; table-layout: fixed;" class="table table-sm">
        <tr>
            @*Временное решение с шириной https://github.com/dompdf/dompdf/issues/1432*@
            <th colspan="3"><p>Загрузка данных:</p></th>
            <th colspan="5"> <input type="file" id="fileLoader" name="files" title="Load File" style = "width:100%"/>   </th>
            <th colspan="2"><button onclick="LoadInfluences()"  style = "width:100%">Загрузить</button></th>
        </tr>
    </table>    
    <table style="width:50%; table-layout: fixed;" class="table table-sm">
        <tr>
            @*Временное решение с шириной https://github.com/dompdf/dompdf/issues/1432*@
            <th colspan="3"><p>Поиск пациента:</p></th>
            <th colspan="5"><input type="text" id="patientId" placeholder="Номер медицинской карты" style = "width:100%"/></th>
            <th colspan="2"><button onclick="SearchPatient()"  style = "width:100%">Поиск</button></th>
        </tr>
    </table>    
    <div id="PatientInfo"></div>
</body>
</html>


<script>
    function SearchPatient() {
        var patientId = $('#patientId').val();
         $.ajax({
            url: '@Url.Action("GetPatientInfo", "Patient")',
            data: {id: patientId},
            type: 'get',
            cache: false,
            async: true,
            success: function (result) {
                $('#PatientInfo').html(result);
            }
        });
    }
</script>
<script>
function LoadInfluences() {
    //var fileSelect = document.getElementById('fileLoader');       
    //var files = fileSelect.files;
    //var file = files[0]; 
    var reader = new FileReader();
    var selectedFile = document.getElementById("fileLoader").files[0];
    reader.onload = function() {
        var comma = this.result.indexOf(',');
        var base64 = this.result.substr(comma + 1);
        console.log(base64);

        var postData = JSON.stringify({ 'data': base64});

    console.log(postData);

        $.ajax({
            url: '@Url.Action("AddInfluencesFromFile", "Patient")',
            contentType: "application/json; charset=uft-8",
            data: JSON.stringify(base64),
            type: 'POST',
            async: true,
            dataType: "json",
            success: function(data) {
                 console.log('success');
            },
            error: function(xhr, status, error) {
                console.log(error);
            }
        });
    };
    reader.readAsDataURL(selectedFile);

    //fr.onload = function() {
    //    var binaryString = this.result;

    //    $.ajax({
    //        url: '@Url.Action("AddInfluencesFromFile", "Patient")',
    //        contentType: "application/octet-stream",
    //        data: { data: binaryString },
    //        type: 'POST',
    //        processData: false,
    //        cache: false,
    //        async: true,
    //        success: function(data) {

    //        },
    //        error: function(xhr, status, error) {

    //        }
    //    });

    //    //$.ajax({
    //    //    url: "http://localhost/Uploader/ServiceUploader.svc/saveDocument",
    //    //    data: JSON.stringify(objUploader),
    //    //    dataType: "json",
    //    //    type: "POST",
    //    //    contentType: "application/json; charset=uft-8",
    //    //    success: function (data) {

    //    //    },
    //    //    error: function (xhr, status, error) {

    //    //    }
    //    //});

    //});
    ////reading file
    //fr.readAsArrayBuffer(file);        
}
</script>
