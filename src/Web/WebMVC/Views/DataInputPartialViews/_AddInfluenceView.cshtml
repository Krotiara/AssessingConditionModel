@using Interfaces;
@model InfluenceViewFormat
@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
}
<html>
    <head>
        <style>
            th {
            text-align: left;
            }
        </style>
    </head>
    <body>
        <div class="panel panel-default">
            <div class="panel-heading">Добавление воздействия</div>
            <div class="panel-body">
                @using (Html.BeginForm("AddInluence", "Patient", FormMethod.Post))
                {
                    <table>
                    <tr>
                        <th>@Html.LabelFor(x => x.PatientId)</th>
                        <th>@Html.TextBoxFor(x=>x.PatientId)</th>
                    </tr>
                    <tr>
                        <th>@Html.LabelFor(x => x.StartTimestamp)</th>
                        <th>@Html.EditorFor(x=>x.StartTimestamp)</th>
                    </tr>
                    <tr>
                        <th>@Html.LabelFor(x => x.EndTimestamp)</th>
                        <th>@Html.EditorFor(x=>x.EndTimestamp)</th>
                    </tr>
                   <tr>
                        <th>@Html.LabelFor(x => x.InfluenceType)</th>
                        <th>@Html.DropDownListFor(x=>x.InfluenceType, Html.GetEnumSelectList(typeof(InfluenceTypes)))</th>
                   </tr>
                    <tr>
                        <th>@Html.LabelFor(x => x.MedicineName)</th>
                        <th>@Html.EditorFor(x=>x.MedicineName)</th>
                   </tr>
                   <tr>
                       <th>
                           <table id="parameters">
                               <thead>
                                   <tr>
                                       <th>@Html.LabelFor(x => x.Parameters)</th>
                                   </tr>
                               </thead>
                               <tbody id="parametersBody">

                               </tbody>
                               <tfoot>
                                   <tr><td><button id="addParamButton">Добавить параметр</button></td></tr>
                               </tfoot>
                           </table>
                       </th>
                   </tr>
                </table>    
                <div><input type="submit" value="Добавить" class="btn btn-success" /></div>
                }
        </div>
         </div>
    </body>
</html>

<script type="text/javascript">
$('#addParamButton').click(function(e) {
    //https://stackoverflow.com/questions/40843105/asp-net-button-click-call-javascript-function-in-beginform-and-stop-form-submit
    e.preventDefault();
    $.ajax({
            url: '@Url.Action("GetPatientParameterTableTemplate", "Medic")',
            type: 'get',
            cache: false,
            async: true,
            success: function (result) {
                $('#parametersBody').append(result);
            }
        });
});
    //function AddParameter() {
    //    $.ajax({
    //        url: '@Url.Action("GetPatientParameterTableTemplate", "Medic")',
    //        type: 'get',
    //        cache: false,
    //        async: true,
    //        success: function (result) {
    //            $('#parametersBody').append(result);
    //        }
    //    });
    //}
    </script>
    
