@using Interfaces;
@model InfluenceViewFormat
@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
}
<html>
    <head>
        <style>
            th {
            text-align: left;
            }
        </style>
    </head>
    <body>
        <div class="panel panel-default">
            <div class="panel-heading">Добавление воздействия</div>
            <div class="panel-body">
                <form asp-action="AddInluence" asp-controller="Patient" id="form">
                @*@using (Html.BeginForm("AddInluence", "Patient", FormMethod.Post))*@
                @*{*@
                    <table>
                    <tr>
                        <th>@Html.LabelFor(x => x.PatientId)</th>
                        <th>@Html.TextBoxFor(x=>x.PatientId)</th>
                    </tr>
                    <tr>
                        <th>@Html.LabelFor(x => x.StartTimestamp)</th>
                        <th>@Html.EditorFor(x=>x.StartTimestamp)</th>
                    </tr>
                    <tr>
                        <th>@Html.LabelFor(x => x.EndTimestamp)</th>
                        <th>@Html.EditorFor(x=>x.EndTimestamp)</th>
                    </tr>
                   <tr>
                        <th>@Html.LabelFor(x => x.InfluenceType)</th>
                        <th>@Html.DropDownListFor(x=>x.InfluenceType, Html.GetEnumSelectList(typeof(InfluenceTypes)))</th>
                   </tr>
                    <tr>
                        <th>@Html.LabelFor(x => x.MedicineName)</th>
                        <th>@Html.EditorFor(x=>x.MedicineName)</th>
                   </tr>
                   
                </table>
                <button id="addParamButton">Добавить параметр</button>
                <div id="parametersContainter">
                    @Html.EditorFor(x=>x.Parameters)
                </div>
                <div><input type="submit" value="Добавить" class="btn btn-success" /></div>
               @* }*@
                </form>
        </div>
         </div>
    </body>
</html>

<script type="text/javascript">
$('#addParamButton').click(function(e) {
    //https://stackoverflow.com/questions/40843105/asp-net-button-click-call-javascript-function-in-beginform-and-stop-form-submit
    e.preventDefault();
    $.ajax({
            url: '@Url.Action("AddPatientParameter", "Medic")',
            data: $('#form').serialize(),
            type: 'POST',
            cache: false,
            async: true,
            success: function (result) {
                $('#parametersContainter').html(result);
            }
        });
});
    //function AddParameter() {
    //    $.ajax({
    //        url: '@Url.Action("GetPatientParameterTableTemplate", "Medic")',
    //        type: 'get',
    //        cache: false,
    //        async: true,
    //        success: function (result) {
    //            $('#parametersBody').append(result);
    //        }
    //    });
    //}
    </script>
    
